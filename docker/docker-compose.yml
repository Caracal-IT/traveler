version: "3.9"
name: traveler

services:
  traveler:
    container_name: traveler
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "8080:8080"
    # Mount configs and logs from the host (optional but useful)
    volumes:
      - ../configs:/root/configs:ro
      - ../logs:/root/logs
    restart: unless-stopped

  keycloak:
    container_name: keycloak
    image: quay.io/keycloak/keycloak:26.0
    command: start-dev --import-realm
    ports:
      - "8081:8080" # expose Keycloak on localhost:8081
    env_file:
      # Checked-in defaults (non-sensitive). You can override any values in the next file.
      - ./keycloak.defaults.env
      # User credentials file (checked in with placeholders). Set your values locally before running.
      - ./keycloak.user.env
    environment:
      # Be explicit about the import location/file so Keycloak surely picks it up on first start
      KEYCLOAK_IMPORT: /opt/keycloak/data/import/traveler-dev-realm.json
      # Relax hostname/HTTPS requirements for local development to avoid 403 HTTPS-required errors
      KC_HOSTNAME_STRICT: "false"
      KC_HOSTNAME_STRICT_HTTPS: "false"
      # If you later front Keycloak with a reverse proxy/SSL terminator, keep this as 'edge'
      KC_PROXY: edge
      # Explicitly set hostname URL to HTTP for local development
      KC_HOSTNAME_URL: http://localhost:8081
    volumes:
      - ./keycloak/realm-export:/opt/keycloak/data/import:ro
    restart: unless-stopped
